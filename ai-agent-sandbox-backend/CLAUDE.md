# 🚨🚨🚨 【重要】ソースファイル必須事項（絶対厳守）

絶対厳守：編集前に必ずルールを読む

本ドキュメントはコーディング用AIエージェント向けの資料です。

## 📝 ソースファイル先頭コメント必須

全てのソースファイル（.ts .tsx）の先頭に必ず以下のコメントを記載：

```typescript
// 絶対厳守：編集前に必ずAI実装ルールを読む
```

既存ファイルにコメントがない場合は必ず追加すること。

## 他のファイルへの参照

**以下のように @<path> の形式で書かれている場合は別のファイルへの参照になりますので、対象ファイルを探して内容を確認してください。**

**以下に記載例を示します。**

@src/mastra/index.ts（src/mastra/index.ts を参照）
@docs/basic-coding-guidelines.md （docs/basic-coding-guidelines.md を参照）

## プロジェクト概要

TypeScriptで構築されたMastraベースのAIエージェントアプリケーションです。MastraはAIエージェント、ワークフロー、ツールを構築するためのフレームワークです。本プロジェクトはNode.js ESモジュールを使用し、天気エージェントの例と関連するツール・ワークフローを含んでいます。

## アーキテクチャ

### コア構造

アプリケーションは `src/mastra/` 以下に整理されています:

- **`index.ts`**: メインのMastraインスタンス設定
  - エージェント、ワークフロー、ツールを登録
  - LibSQLストレージを設定(デフォルトはインメモリ)
  - テレメトリ用のPinoロガーをセットアップ

- **`agents/`**: AIエージェント定義
  - 各エージェントはツールを使用し、ワークフローを実行可能
  - 例: `weather-agent.ts` は天気関連のアシスタンス機能を提供

- **`workflows/`**: Mastraのワークフローエンジンを使用したマルチステップワークフロー
  - ワークフローはスキーマを使って複数のステップを調整
  - 例: `weather-workflow.ts` は天気データの取得とアクティビティ計画を調整

- **`tools/`**: エージェントが呼び出せる再利用可能なツール
  - ツールは定義されたスキーマを持つ関数
  - 例: `weather-tool.ts` はOpenWeatherMap APIと統合

### ストレージ設定

Mastraインスタンスは永続化のためにLibSQLStoreを使用します。デフォルトではインメモリストレージ(`:memory:`)に設定されています。再起動後もデータを永続化するには、`src/mastra/index.ts` のストレージURLを変更してください:

```typescript
storage: new LibSQLStore({
  url: "file:../mastra.db",  // ファイルベースの永続化
}),
```

### 環境設定

必須の環境変数:
- `OPENAI_API_KEY`: LLM呼び出し用のOpenAI APIキー

## 共通コマンド

### 開発
```bash
npm run dev         # ホットリロード付き開発サーバーを起動
```

### ビルドと本番環境
```bash
npm run build       # アプリケーションをビルド
npm start          # 本番サーバーを起動
```

### パッケージ管理
プロジェクトは厳密なパッケージバージョン固定を使用しています(`.npmrc`で設定)。依存関係を追加する際、バージョンは正確なバージョンにロックされます。

## 開発ノート

- **モジュールシステム**: ESモジュールを使用 (package.jsonの `"type": "module"`)
- **TypeScript**: strictモードとES2022ターゲットで設定
- **Nodeバージョン**: Node.js >= 20.9.0 が必要
- **ビルド出力**: コンパイルされたファイルは `dist/` ディレクトリに出力 (ただし現在は`noEmit`が有効)

## 新しいコンポーネントの追加

### 新しいエージェントの作成
1. `src/mastra/agents/` にエージェントファイルを作成
2. ツールと設定でエージェントを定義
3. `src/mastra/index.ts` の `agents` オブジェクトに登録

### 新しいワークフローの作成
1. `src/mastra/workflows/` にワークフローファイルを作成
2. 入出力スキーマでワークフローステップを定義
3. `src/mastra/index.ts` の `workflows` オブジェクトに登録

### 新しいツールの作成
1. `src/mastra/tools/` にツールファイルを作成
2. 入力用のZodスキーマでツールを定義
3. 関連するエージェントにインポートして渡す

## 関連ドキュメント

### **重要: 基本的なコーディングガイドライン**

必ず以下のドキュメントを参照してから開発を開始してください:

@docs/basic-coding-guidelines.md
